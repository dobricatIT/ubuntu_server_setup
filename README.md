# Bash Script для первичной настройки VPS/VDS сервера на Ubuntu/Debian

Этот Bash-скрипт предназначен для быстрой настройки сервера на базе Ubuntu или Debian. Он позволяет:

- Обновить систему
- Установить необходимые утилиты
- Создать нового пользователя с правами `sudo`
- Изменить порт SSH для повышения безопасности
- Настроить файрвол (UFW)
- Запретить доступ для пользователя `root` по SSH
- Установить защиту от брутфорс-атак с помощью Fail2Ban
- Установить и настроить `rsyslog` для ведения логов (если они отсутствуют)
- Настроить вход по SSH-ключу и отключить вход по паролю

---

## Требования

Для запуска скрипта потребуется:

- Доступ к серверу с правами `root`
- Операционная система: Ubuntu или Debian (другие дистрибутивы могут не поддерживаться)

---

## Установка и запуск

Чтобы запустить скрипт, используйте одну из следующих команд:

1. Для запуска скрипта с правами `root`:

    ```bash
    bash <(curl -Ls https://raw.githubusercontent.com/dobricatIT/ubuntu_server_setup/main/setup.sh)
    ```

2. Если вам нужно явно указать `sudo`:

    ```bash
    sudo curl -Ls https://raw.githubusercontent.com/dobricatIT/ubuntu_server_setup/main/setup.sh -o /tmp/setup_server.sh && sudo bash /tmp/setup_server.sh
    ```

---

## Основные этапы работы скрипта

### 1. Обновление системы

Скрипт обновит список пакетов и установит последние обновления:

```bash
apt-get update -y
apt-get upgrade -y
```

---

### 2. Установка необходимых утилит

Устанавливаются следующие утилиты:

- **`sudo`**: Утилита для выполнения административных задач.
- **`ufw`**: Файрвол для управления доступом к серверу.
- **`fail2ban`**: Защита от брутфорс-атак.
- **`rsyslog`**: Система логирования (устанавливается, если логи отсутствуют).

---

### 3. Проверка наличия логов

Скрипт проверяет, существуют ли логи (`auth.log`) в системе. Если логи отсутствуют, устанавливается и настраивается `rsyslog`.

---

### 4. Создание нового пользователя

- Создается пользователь с правами `sudo`.
- Настраивается SSH-доступ с использованием SSH-ключа.
- Отключается вход по паролю (опционально).

---

### 5. Настройка SSH

- Изменяется стандартный порт SSH (22) на другой, указанный пользователем.
- Перезапускается служба SSH для применения изменений.

---

### 6. Настройка безопасности

#### **Настройка файрвола (UFW):**
- Разрешаются:
  - Новый порт SSH.
  - Порты для HTTP и HTTPS (80 и 443).
- Все остальные входящие соединения блокируются.
- Исходящие соединения разрешены.

#### **Отключение входа для `root`:**
- При выборе этого варианта вход для `root` через SSH будет запрещен.

---

### 7. Установка и настройка Fail2Ban

Fail2Ban защищает сервер от атак типа «грубой силы», блокируя IP-адреса злоумышленников.

- Пользователь может задать:
  - Максимальное количество неудачных попыток входа.
  - Время блокировки IP-адреса.
  - Интервал подсчета попыток входа.
- Перезапускается служба Fail2Ban.

---

### 8. Настройка входа только по SSH

- При создании нового пользователя можно настроить вход **только по SSH**.
- Добавляется публичный ключ SSH.
- Отключается вход по паролю:
    ```bash
    PasswordAuthentication no
    ```

После этих изменений перезапускается служба SSH.

---

## Почему стоит использовать этот скрипт?

- **Ускорение работы**: Автоматизирует рутинные задачи.
- **Безопасность**: Снижает вероятность атак и взломов.
- **Гибкость**: Подходит для различных сценариев настройки серверов.
- **Удобность**: Все нужные функции в одном скрипте, с автоматической настройкой и удобным, минималистичным интерфейсом.

---
